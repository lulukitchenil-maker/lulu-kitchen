# 📋 הוראות לאישור תשלום ידני (Admin)

## סקירה כללית

המערכת עובדת עם תוכנית 59₪ של Grow, שאינה כוללת API או webhooks אמיתיים.
לכן, אישור תשלום נעשה **ידנית** ע"י בעל העסק.

---

## ⚠️ חשוב להבין:

1. **אין webhook אמיתי** מ-Bit או Grow
2. **אין אישור אוטומטי** מהספק
3. התשלום נשאר `pending` עד שתאשרו אותו ידנית
4. **כשתעדכנו ל-paid** - המערכת מגיבה אוטומטית:
   - שולחת מיילים
   - מנקה את סל הלקוח (אם הוא עדיין באתר)
   - מעדכנת את הסטטוס

---

## 🔄 תהליך אישור תשלום

### שלב 1: לקוח משלם
- לקוח בוחר Bit או Grow
- משלם דרך האפליקציה/אתר שלהם
- ההזמנה נשארת במצב `pending` במערכת

### שלב 2: בדיקה ידנית (אתם)
אתם צריכים לבדוק:
1. **באפליקציית Bit** - האם התקבל תשלום?
2. **בחשבון Grow** - האם התקבל תשלום?
3. לוודא שהסכום תואם להזמנה

### שלב 3: עדכון ב-DB (אתם)

#### אפשרות 1: דרך Supabase Dashboard (מומלץ)
1. היכנסו ל-Supabase Dashboard
2. לחצו על Table Editor → `orders`
3. מצאו את ההזמנה (לפי `id` או `customer_name`)
4. עדכנו את השדה `payment_status` מ-`pending` ל-`paid`
5. שמרו

#### אפשרות 2: דרך SQL Query
```sql
UPDATE orders
SET payment_status = 'paid',
    updated_at = NOW()
WHERE id = 'ORDER_ID_HERE';
```

### שלב 4: מה קורה אחרי העדכון? (אוטומטי)
1. ✅ מיילים נשלחים **אוטומטית**:
   - ללקוח (אישור הזמנה)
   - לבעלי העסק (הודעה על תשלום)
2. ✅ אם הלקוח עדיין באתר - הסל שלו מתנקה
3. ✅ הלקוח מועבר לעמוד "תודה"

---

## 📊 מעקב אחרי הזמנות

### סטטוסים אפשריים:

| סטטוס | משמעות | פעולה נדרשת |
|-------|---------|-------------|
| `pending` | ממתין לאישור תשלום | בדקו אם התשלום התקבל → עדכנו ל-paid |
| `paid` | תשלום אושר | אין צורך בפעולה |

---

## 🚨 טיפול בבעיות

### בעיה: לקוח טוען ששילם אבל לא קיבל אישור
**פתרון:**
1. בדקו בחשבון Bit/Grow - האם התקבל התשלום?
2. אם כן - עדכנו ידנית את ההזמנה ל-`paid`
3. המיילים יישלחו אוטומטית

### בעיה: מייל לא נשלח
**פתרון:**
1. וודאו ש-SMTP מוגדר נכון ב-Environment Variables
2. בדקו את הלוגים ב-Supabase Edge Functions
3. אם צריך - שלחו מייל ידנית ללקוח

### בעיה: תשלום כפול
**פתרון:**
המערכת חוסמת תשלום כפול אוטומטית. אם הזמנה כבר `paid`, לא ניתן לשלם שוב.

---

## 🔮 אפשרויות לעתיד

### אם תעבור לתוכנית Grow עם API:
אז ניתן יהיה להפעיל webhooks אמיתיים ולאשר תשלומים אוטומטית.

### עד אז:
העבודה הידנית היא **חלק מהתהליך** ולא באג.

---

## 📞 שאלות?

אם יש בעיה או שאלה לגבי התהליך, אפשר לבדוק:
1. Supabase Dashboard → Table Editor → orders
2. Supabase Functions → Logs (לראות אם יש שגיאות)
3. Edge Functions → send-payment-confirmation (לוגים של מיילים)
